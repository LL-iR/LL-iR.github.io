<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>问卷调查</title>
    <link rel="stylesheet" href="li.css" type="text/css" media="all" />

    <script>
        const messagest = "一定要说真话哦<br/>......<br/>最喜欢你了^_^";
        document.addEventListener("DOMContentLoaded", function () {
            const messages = messagest.split('<br/>')
            let index = 0;
            const answerInput = document.getElementById('answer');

            function showPopup() {
                if (index < messages.length) {
                    // 创建遮罩层
                    let overlay = document.createElement("div");
                    overlay.className = "overlay";
                    document.body.appendChild(overlay);

                    let popup = document.createElement("div");
                    popup.className = "popup";
                    popup.textContent = messages[index];
                    let button = document.createElement("button");
                    button.textContent = "关闭";
                    button.onclick = function () {
                        document.body.removeChild(popup);
                        document.body.removeChild(overlay); // 移除遮罩层
                        if (index === messages.length - 1) {
                            answerInput.classList.add('animate');
                        } else {
                            index++;
                            showPopup();
                        }
                    };
                    popup.appendChild(document.createElement("br"));
                    popup.appendChild(button);
                    document.body.appendChild(popup);
                }
            }

            showPopup();
        });
    </script>
    <style>
        .youscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #ffcad382;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .youtext {
            font-size: 5vw;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f7;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 40px; 
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 25px;
            width: 90%;
            max-width: 50%; 
            text-align: center;
        }

        
        #question {
            font-size: 18px;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .input-container {
            position: relative;
            margin-bottom: 30px;
        }

        #answer {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            color: #333;
            transition: all 0.3s ease;
            background-color: #fafafa;
            box-sizing: border-box;
            transform: scale(0.9);
            opacity: 0;
        }

        
        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        #answer.animate {
            animation: scaleIn 0.5s ease-out forwards;
        }

        #answer:focus {
            outline: none;
            border-color: #e0d5ff;
            background-color: white;
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
        }

        #answer::placeholder {
            color: #999;
        }

        /* 按钮美化 */
        #nextBtn {
            background-color: #c9b7fb;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        #nextBtn:hover {
            background-color: #c9b7fb;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
        }

        #nextBtn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* 弹窗样式 */
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid #ead9ff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            z-index: 1002;
            max-width: 90%;
            color: #333;
        }

        .popup button {
            margin-top: 20px;
            padding: 8px 15px;
            border-radius: 8px;
            border: none;
            background-color: #c9b7fb;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .popup button:hover {
            background-color: #c9b7fb;
        }

      
        .youscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #ffcad382;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            display: none;
        }

        .yes-text {
            font-size: 7vw;
            color: #6c5ce7;
            margin-bottom: 30px;
        }

        .yes-image {
            max-width: 80%;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* 血雨动画 */
        @keyframes bloodFall {
            0% {
                top: -10%;
            }
            100% {
                top: 100%;
            }
        }

        .blood-drop {
            position: absolute;
            width: 2px;
            height: 8px;
            background: red;
            animation: bloodFall 2s linear infinite;
        }


        .apocalypse-mode {
            background-color: #8B0000;
            position: relative;
            overflow: hidden;
        }

        .blood-text {
            position: absolute;
            color: red;
            font-size: 16px;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

       
       .blood-text.blink {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                opacity: 1;
            }
        }

        /* 按钮按下效果 */
        #nextBtn.pressed {
            background-color: #a588f5;
            transform: translateY(0);
            box-shadow: none;
        }

        /* 遮罩层样式 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }
    </style>
</head>

<body>
    <audio id="music" src="2.mp3" loop></audio>
    <audio id="musichp" src="1.mp3" loop></audio>
    <audio id="scream" src="file.mp3"></audio> 
    <div class="container">
        <div id="question"></div>
        <div class="input-container">
            <input type="text" id="answer" autocomplete="off" placeholder="请输入你的答案..." />
        </div>
        <button onclick="nextQuestion()" id="nextBtn">下一个</button>
    </div>

    <div class="youscreen" style="display: none;">
        <h1 class="yes-text">我也喜欢你~♡︎ᐝ</h1>
        <img src="haipi.gif" alt="HAPI" class="yes-image" />
    </div>
    <script>
        setInterval(() => {
            (function (a) {
                return (function (a) {
                    return Function('Function(arguments[0] + "' + a + '")()');
                })(a);
            })('bugger')('de', 0, 0, (0, 0));
        }, 1000);
        const answerst = "你<br/>喜欢你<br/>是你<br/>you<br/>我爱你<br/>我喜欢你<br/>你啊<br/>只喜欢你<br/>洛黎<br/>小黎<br/>洛";
        const questionst = "最喜欢的歌是什么?<br/>最喜欢什么颜色?<br/>最喜欢的食物是什么?<br/>最喜欢的季节是什么?<br/>最喜欢什么动物?<br/>最喜欢的人是谁?";
        const textst = "为什么不填我<br/>说好的地久天长呢<br/>凝视着我，目光别移开<br/>我一直注视着你<br/>拒绝是新型的告白对吧<br/>我能感觉到你心里有我，对不对<br/>我知道你喜欢我的 对吧<br/>我的视线从未从你身上离开<br/>抗拒也许是另一种靠近，对不对对不对";
        const textstw = "你要是只能跟我在一起就好了<br/>你将随我一起腐烂……<br/>You shouldn't do this<br/>别白费力气啦…… 别白费力气啦……<br/>只可以钟情于我……<br/>爱你…… 你…… 爱…… 爱你……<br/>I'm sorry<br/>我们注定要一直甜蜜相伴<br/>一切都已经板上钉钉咯<br/>爱你...你...爱...爱你...<br/>你只能看着我<br/>你的心里只能有我<br/>离开我是不被允许的<br/>我会一直在你身边，不管你愿不愿意<br/>你是我的，永远都是";
        const opportunity = "再给你一次机会";
        const textawa = "你以为这样就结束了？<br/>你跑不掉的<br/>你永远属于我<br/>别白费力气啦.....<br/>你心里一直有我，对不对<br/>爱你...爱...爱你...<br/>You shouldn't do this<br/>我爱你这种轻浮到极点的话语，真的是让人忍不住想吐呢。<br/>如果你的眼睛没有一直注视着我的话，那就挖出来好了<br/>爱只有在染满鲜血时才是最美丽的呀！";

        const music = document.getElementById('music');
        const questions = questionst.split('<br/>');
        let currentStep = 0;
        let isApocalypse = false;
        let retryCount = 0;
        const container = document.querySelector('.container');
        const youscreen = document.querySelector('.youscreen');
        const nextBtn = document.getElementById('nextBtn'); 

        function nextQuestion() {
            if (currentStep === questions.length - 1) {
                checkFinalAnswer();
                nextBtn.disabled = true; 
            } else {
                currentStep++;
                updateQuestion();
            }
        }

        function checkFinalAnswer() {
            const answer = document.getElementById('answer').value.trim().toLowerCase();
            const validAnswers = answerst.split('<br/>').map(a => a.trim().toLowerCase());

            if (!validAnswers.includes(answer)) {
                if (retryCount === 0) {
                    triggerBloodEffect();
                } else {
                    triggerDeeperApocalypse();
                }
            } else {
                document.getElementById('nextBtn').style.display = 'none';
                container.style.display = 'none';
                youscreen.style.display = 'flex';
                music.pause();
                document.getElementById('musichp').play();
                setTimeout(() => {
                    removeTextAndImage();
                }, 3000);
            }
        }

        function createBloodDrops() {
            const numDrops = 100; 
            for (let i = 0; i < numDrops; i++) {
                const drop = document.createElement('div');
                drop.className = 'blood-drop';
                drop.style.left = `${Math.random() * 100}%`;
                drop.style.animationDuration = `${Math.random() * 3 + 2}s`;
                document.body.appendChild(drop);
            }
        }

        function removeBloodDrops() {
            const drops = document.querySelectorAll('.blood-drop');
            drops.forEach(drop => drop.remove());
        }

        function removeBloodTexts() {
            const texts = document.querySelectorAll('.blood-text');
            texts.forEach(text => text.remove());
        }

        function showBloodTexts() {
            const texts = textst.split('<br/>');
            const nicknames = ["亲爱的", "宝贝", "甜心"];
            const createText = () => {
                const textElement = document.createElement('div');
                let text = texts[Math.floor(Math.random() * texts.length)];
                if (Math.random() < 0.3) {
                    text = nicknames[Math.floor(Math.random() * nicknames.length)] + " " + text;
                }
                textElement.className = 'blood-text blink';
                textElement.textContent = text;
                Object.assign(textElement.style, {
                    left: `${Math.random() * 95}%`,
                    top: `${Math.random() * 95}%`,
                    fontSize: `${Math.random() * 16 + 18}px`,
                    transform: `skew(${Math.random() * 10 - 5}deg, ${Math.random() * 10 - 5}deg)`,
                    textShadow: '1px 1px 0 rgba(0, 0, 0, 0.3), -1px -1px 0 rgba(0, 0, 0, 0.3), 1px -1px 0 rgba(0, 0, 0, 0.3), -1px 1px 0 rgba(0, 0, 0, 0.3)' 
                });
                document.body.appendChild(textElement);
                setTimeout(() => {
                    textElement.style.opacity = 1;
                }, 0);
                setTimeout(() => {
                    textElement.style.opacity = 0;
                    setTimeout(() => {
                        textElement.remove();
                    }, 1000);
                }, 5000);
            };
            let bloodTextInterval = setInterval(createText, 500); // 每半秒创建一个文字元素
            return bloodTextInterval;
        }

        function triggerBloodEffect() {
            const screamAudio = document.getElementById('scream');
            screamAudio.play();
            music.play();
            isApocalypse = true;
            document.body.classList.add('apocalypse-mode', 'apocalypse-shake');
            createBloodDrops();
            let bloodTextInterval = showBloodTexts();

            setTimeout(() => {
                document.body.classList.remove('apocalypse-shake');
                const retryMessage = document.createElement('div');
                retryMessage.className = 'popup';
                retryMessage.textContent = opportunity;
                const closeBtn = document.createElement('button');
                closeBtn.textContent = '关闭';
                closeBtn.onclick = () => {
                    clearInterval(bloodTextInterval);
                    document.body.removeChild(retryMessage);
                    // 移除遮罩层
                    const overlay = document.querySelector('.overlay');
                    if (overlay) {
                        document.body.removeChild(overlay);
                    }
                    document.body.classList.remove('apocalypse-mode');
                    removeBloodDrops();
                    removeBloodTexts(); // 移除血雨文字
                    retryCount++;
                    updateQuestion();
                    isApocalypse = false;
                    music.pause();
                    music.currentTime = 0;
                    nextBtn.disabled = false; // 启用按钮
                };
                retryMessage.appendChild(closeBtn);

                // 创建遮罩层
                let overlay = document.createElement("div");
                overlay.className = "overlay";
                document.body.appendChild(overlay);

                document.body.appendChild(retryMessage);
            }, 3000);
        }

        function triggerDeeperApocalypse(shouldShowBloodTexts = true) {
                    const screamAudio = document.getElementById('scream');
                    screamAudio.play();
                    music.play();
                    document.querySelector('.container')?.remove();
                    document.body.classList.add('apocalypse-mode');
                    createBloodDrops();

                    if (shouldShowBloodTexts) {
                        showBloodTexts();
                    }

                    const texts = textstw.split('<br/>');

                    setInterval(() => {
                        const textElement = document.createElement('div');
                        textElement.className = 'blood-text blink';
                        textElement.textContent = texts[Math.floor(Math.random() * texts.length)];
                        Object.assign(textElement.style, {
                            left: `${Math.random() * 95}%`,
                            top: `${Math.random() * 95}%`,
                            fontSize: `${Math.random() * 16 + 18}px`,
                            transform: `skew(${Math.random() * 10 - 5}deg, ${Math.random() * 10 - 5}deg)`,
                            opacity: 0
                        });
                        document.body.appendChild(textElement);

                        setTimeout(() => {
                            textElement.style.opacity = 1;
                        }, 0);

                        setTimeout(() => {
                            textElement.style.opacity = 0;
                            setTimeout(() => {
                                textElement.remove();
                            }, 1000);
                        }, 5000);

                        const boxElement = document.createElement('div');
                        boxElement.className = 'blood-box';
                        boxElement.textContent = texts[Math.floor(Math.random() * texts.length)];
                        Object.assign(boxElement.style, {
                            left: `${Math.random() * 90}%`,
                            top: `${Math.random() * 90}%`,
                            width: `${Math.random() * 250 + 150}px`,
                            transform: `rotate(${Math.random() * 30 - 15}deg)`,
                            opacity: 0
                        });
                        document.body.appendChild(boxElement);

                        setTimeout(() => {
                            boxElement.style.opacity = 1;
                        }, 0);

                        setTimeout(() => {
                            boxElement.style.opacity = 0;
                            setTimeout(() => {
                                boxElement.remove();
                            }, 1000);
                        }, 30000);

                    }, 200);
                }
        function updateQuestion() {
            document.getElementById('question').textContent = questions[currentStep];
            document.getElementById('answer').value = '';
            document.getElementById('answer').focus();
            nextBtn.disabled = false; // 启用按钮
        }

        updateQuestion();

        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        // 优化音频播放逻辑
        document.addEventListener('touchstart', function() {
            document.getElementById('music').play();
            document.removeEventListener('touchstart', arguments.callee);
        });

        function removeTextAndImage() {
            const yesText = document.querySelector('.yes-text');
            const yesImage = document.querySelector('.yes-image');
            const musichp = document.getElementById('musichp');
            const text = yesText.textContent;
            let index = text.length;

            const typingInterval = setInterval(() => {
                if (index > 0) {
                    index--;
                    yesText.textContent = text.slice(0, index);
                } else {
                    clearInterval(typingInterval);
                    yesImage.remove();
                    musichp.pause();
                    ApocalypseMode();
                    triggerDeeperApocalypse(false);
                   
                }
            }, 200);
        }

        function ApocalypseMode() {
            music.play();
            document.body.classList.add('apocalypse-mode');
            createBloodDrops();
            const texts = textawa.split('<br/>');
            const nicknames = ["亲爱的", "宝贝", "甜心"];
            const createText = () => {
                const textElement = document.createElement('div');
                let text = texts[Math.floor(Math.random() * texts.length)];
                if (Math.random() < 0.3) {
                    text = nicknames[Math.floor(Math.random() * nicknames.length)] + " " + text;
                }
                textElement.className = 'blood-text blink';
                textElement.textContent = text;
                Object.assign(textElement.style, {
                    left: `${Math.random() * 95}%`,
                    top: `${Math.random() * 95}%`,
                    fontSize: `${Math.random() * 16 + 18}px`,
                    transform: `skew(${Math.random() * 10 - 5}deg, ${Math.random() * 10 - 5}deg)`,
                    textShadow: '1px 1px 0 rgba(0, 0, 0, 0.3), -1px -1px 0 rgba(0, 0, 0, 0.3), 1px -1px 0 rgba(0, 0, 0, 0.3), -1px 1px 0 rgba(0, 0, 0, 0.3)' 
                });
                document.body.appendChild(textElement);
                setTimeout(() => {
                    textElement.style.opacity = 1;
                }, 0);
                setTimeout(() => {
                    textElement.style.opacity = 0;
                    setTimeout(() => {
                        textElement.remove();
                    }, 1000);
                }, 5000);
            };
            let bloodTextInterval = setInterval(createText, 200); // 每半秒创建一个文字元素
            return bloodTextInterval;
        }
    </script>
</body>

</html>    
